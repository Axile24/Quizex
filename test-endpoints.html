<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>QuizEx API Test</title>
</head>
<body>
    <h1>QuizEx API Test Interface</h1>
    <p>API URL: <span id="apiUrl">https://your-api-url.amazonaws.com</span></p>
    
    <div>
        <h3>1. Anv√§ndarhantering</h3>
        
        <h3>Skapa Anv√§ndare</h3>
        <input type="text" id="userName" placeholder="Anv√§ndarnamn" value="Test Anv√§ndare">
        <input type="email" id="userEmail" placeholder="E-post" value="test@example.com">
        <button onclick="createUser()">Skapa Anv√§ndare</button>
        <div id="createUserResult"></div>
        
        <h3>Logga In</h3>
        <input type="email" id="loginEmail" placeholder="E-post" value="test@example.com">
        <input type="text" id="loginName" placeholder="Namn" value="Test Anv√§ndare">
        <button onclick="loginUser()">Logga In</button>
        <div id="loginUserResult"></div>
    </div>

    <div>
        <h2>2. Quizhantering</h2>
        
        <h3>Skapa Quiz</h3>
        <input type="text" id="quizTitle" placeholder="Quiz Titel" value="Test Quiz">
        <input type="text" id="quizDescription" placeholder="Beskrivning" value="En test quiz">
        <input type="text" id="quizCreatedBy" placeholder="Skapad av" value="test@example.com">
        <button onclick="createQuiz()">Skapa Quiz</button>
        <div id="createQuizResult"></div>
        
        <h3>H√§mta Alla Quizer</h3>
        <button onclick="getAllQuizzes()">H√§mta Alla Quizer</button>
        <div id="getAllQuizzesResult"></div>
        
        <h3>Ta Bort Quiz</h3>
        <input type="text" id="deleteQuizId" placeholder="Quiz ID">
        <button onclick="deleteQuiz()">Ta Bort Quiz</button>
        <div id="deleteQuizResult"></div>
    </div>

    <div>
        <h2>3. Fr√•gehantering</h2>
        
        <h3>L√§gg Till Fr√•ga</h3>
        <input type="text" id="questionQuizId" placeholder="Quiz ID">
        <input type="text" id="questionText" placeholder="Fr√•ga" value="Vad √§r 2+2?">
        <input type="text" id="questionOptions" placeholder="Alternativ (kommaseparerade)" value="3,4,5,6">
        <input type="text" id="correctAnswer" placeholder="R√§tt svar" value="4">
        <input type="number" id="latitude" placeholder="Latitud" value="59.3293" step="any">
        <input type="number" id="longitude" placeholder="Longitud" value="18.0686" step="any">
        <button onclick="addQuestionToQuiz()">L√§gg Till Fr√•ga</button>
        <div id="addQuestionResult"></div>
        
        <h3>H√§mta Quiz Fr√•gor</h3>
        <input type="text" id="getQuestionsQuizId" placeholder="Quiz ID">
        <button onclick="getQuizQuestions()">H√§mta Fr√•gor</button>
        <div id="getQuestionsResult"></div>
    </div>

    <div>
        <h2>4. Leaderboard</h2>
        
        <h3>Registrera Po√§ng</h3>
        <input type="text" id="scoreQuizId" placeholder="Quiz ID">
        <input type="number" id="scoreValue" placeholder="Po√§ng" value="100">
        <button onclick="registerScore()">Registrera Po√§ng</button>
        <div id="registerScoreResult"></div>
        
        <h3>H√§mta Leaderboard</h3>
        <input type="text" id="leaderboardQuizId" placeholder="Quiz ID">
        <button onclick="getLeaderboard()">H√§mta Leaderboard</button>
        <div id="getLeaderboardResult"></div>
    </div>

    <div>
        <h2>5. Testresultat</h2>
        <div id="testResults"></div>
    </div>

    <script>
        let apiBaseUrl = 'https://zdgjj51feh.execute-api.eu-north-1.amazonaws.com';
        let authToken = '';

        // Uppdatera API URL n√§r sidan laddas
        window.onload = function() {
            document.getElementById('apiUrl').textContent = apiBaseUrl;
        };

        // Hj√§lpfunktion f√∂r API-anrop
        async function makeApiCall(endpoint, method = 'GET', body = null, requiresAuth = false) {
            const url = `${apiBaseUrl}${endpoint}`;
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            if (requiresAuth && authToken) {
                options.headers['Authorization'] = `Bearer ${authToken}`;
            }

            if (body) {
                options.body = JSON.stringify(body);
            }

            console.log('üåê API Request:', { 
                method, 
                url, 
                body, 
                requiresAuth, 
                hasToken: !!authToken,
                timestamp: new Date().toISOString() 
            });

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                const result = { success: response.ok, data: data, status: response.status };
                console.log('üåê API Response:', { 
                    url, 
                    status: response.status, 
                    success: response.ok, 
                    timestamp: new Date().toISOString() 
                });
                return result;
            } catch (error) {
                console.error('‚ùå API Error:', { url, error: error.message, timestamp: new Date().toISOString() });
                return { success: false, error: error.message };
            }
        }

        // Hj√§lpfunktion f√∂r att visa resultat
        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            if (result.success) {
                element.innerHTML = `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                element.innerHTML = `<pre>Fel: ${result.error || JSON.stringify(result.data, null, 2)}</pre>`;
            }
        }

        // Anv√§ndarhanteringsfunktioner
        async function createUser() {
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            
            console.log('üöÄ Creating user:', { name, email, timestamp: new Date().toISOString() });
            const result = await makeApiCall('/user', 'POST', { name, email });
            console.log('‚úÖ User creation result:', result);
            displayResult('createUserResult', result);
        }

        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const name = document.getElementById('loginName').value;
            
            console.log('üîê Logging in user:', { email, name, timestamp: new Date().toISOString() });
            const result = await makeApiCall('/login', 'POST', { email, name });
            if (result.success && result.data.data && result.data.data.token) {
                authToken = result.data.data.token;
                console.log('üé´ Auth token received and stored');
                document.getElementById('testResults').innerHTML += '<p>Auth token sparad!</p>';
            }
            console.log('‚úÖ Login result:', result);
            displayResult('loginUserResult', result);
        }

        // Quizhanteringsfunktioner
        async function createQuiz() {
            const title = document.getElementById('quizTitle').value;
            const description = document.getElementById('quizDescription').value;
            const createdBy = document.getElementById('quizCreatedBy').value;
            
            console.log('üìù Creating quiz:', { title, description, createdBy, timestamp: new Date().toISOString() });
            const result = await makeApiCall('/quiz', 'POST', { title, description, createdBy }, true);
            if (result.success && result.data.data && result.data.data.quizId) {
                console.log('üìã Quiz created with ID:', result.data.data.quizId);
                document.getElementById('questionQuizId').value = result.data.data.quizId;
                document.getElementById('deleteQuizId').value = result.data.data.quizId;
                document.getElementById('getQuestionsQuizId').value = result.data.data.quizId;
            }
            console.log('‚úÖ Quiz creation result:', result);
            displayResult('createQuizResult', result);
        }

        async function getAllQuizzes() {
            console.log('üìö Fetching all quizzes:', { timestamp: new Date().toISOString() });
            const result = await makeApiCall('/quizzes', 'GET');
            console.log('‚úÖ Get all quizzes result:', result);
            displayResult('getAllQuizzesResult', result);
        }

        async function deleteQuiz() {
            const quizId = document.getElementById('deleteQuizId').value;
            console.log('üóëÔ∏è Deleting quiz:', { quizId, timestamp: new Date().toISOString() });
            const result = await makeApiCall(`/quiz/${quizId}`, 'DELETE', null, true);
            console.log('‚úÖ Delete quiz result:', result);
            displayResult('deleteQuizResult', result);
        }

        // Fr√•gehanteringsfunktioner
        async function addQuestionToQuiz() {
            const quizId = document.getElementById('questionQuizId').value;
            const question = document.getElementById('questionText').value;
            const options = document.getElementById('questionOptions').value.split(',').map(opt => opt.trim());
            const correctAnswer = document.getElementById('correctAnswer').value;
            const latitude = document.getElementById('latitude').value;
            const longitude = document.getElementById('longitude').value;
            
            console.log('‚ùì Adding question to quiz:', { quizId, question, options, correctAnswer, latitude, longitude, timestamp: new Date().toISOString() });
            const result = await makeApiCall(`/quiz/${quizId}/question`, 'POST', { 
                question, 
                options, 
                correctAnswer,
                latitude,
                longitude
            }, true);
            console.log('‚úÖ Add question result:', result);
            displayResult('addQuestionResult', result);
        }

        async function getQuizQuestions() {
            const quizId = document.getElementById('getQuestionsQuizId').value;
            console.log('üìã Fetching quiz questions:', { quizId, timestamp: new Date().toISOString() });
            const result = await makeApiCall(`/quiz/${quizId}/questions`, 'GET');
            console.log('‚úÖ Get quiz questions result:', result);
            displayResult('getQuestionsResult', result);
        }

        // Leaderboard-funktioner
        async function registerScore() {
            const quizId = document.getElementById('scoreQuizId').value;
            const score = document.getElementById('scoreValue').value;
            
            console.log('üèÜ Registering score:', { quizId, score: parseInt(score), timestamp: new Date().toISOString() });
            const result = await makeApiCall(`/quiz/${quizId}/score`, 'POST', { 
                quizId,
                score: parseInt(score)
            }, true);
            console.log('‚úÖ Register score result:', result);
            displayResult('registerScoreResult', result);
        }

        async function getLeaderboard() {
            const quizId = document.getElementById('leaderboardQuizId').value;
            console.log('üèÖ Fetching leaderboard:', { quizId, timestamp: new Date().toISOString() });
            const result = await makeApiCall(`/quiz/${quizId}/leaderboard`, 'GET');
            console.log('‚úÖ Get leaderboard result:', result);
            displayResult('getLeaderboardResult', result);
        }

        // Testa alla endpoints funktion
        async function testAllEndpoints() {
            console.log('üß™ Starting comprehensive API test suite:', { timestamp: new Date().toISOString() });
            document.getElementById('testResults').innerHTML = '<h3>K√∂r alla tester...</h3>';
            
            // Test 1: Skapa Anv√§ndare
            console.log('üìù Test 1: Creating user...');
            document.getElementById('testResults').innerHTML += '<p>1. Testar skapa anv√§ndare...</p>';
            await createUser();
            
            // Test 2: Logga In Anv√§ndare
            console.log('üîê Test 2: Logging in user...');
            document.getElementById('testResults').innerHTML += '<p>2. Testar logga in anv√§ndare...</p>';
            await loginUser();
            
            // Test 3: Skapa Quiz
            console.log('üìù Test 3: Creating quiz...');
            document.getElementById('testResults').innerHTML += '<p>3. Testar skapa quiz...</p>';
            await createQuiz();
            
            // Test 4: H√§mta Alla Quizer
            console.log('üìö Test 4: Fetching all quizzes...');
            document.getElementById('testResults').innerHTML += '<p>4. Testar h√§mta alla quizer...</p>';
            await getAllQuizzes();
            
            // Test 5: L√§gg Till Fr√•ga
            console.log('‚ùì Test 5: Adding question...');
            document.getElementById('testResults').innerHTML += '<p>5. Testar l√§gg till fr√•ga...</p>';
            await addQuestionToQuiz();
            
            // Test 6: H√§mta Quiz Fr√•gor
            console.log('üìã Test 6: Fetching quiz questions...');
            document.getElementById('testResults').innerHTML += '<p>6. Testar h√§mta quiz fr√•gor...</p>';
            await getQuizQuestions();
            
            console.log('üéâ All API tests completed successfully!', { timestamp: new Date().toISOString() });
            document.getElementById('testResults').innerHTML += '<p>Alla tester slutf√∂rda!</p>';
        }
    </script>

    <div>
        <h2>6. Snabbtest</h2>
        <button onclick="testAllEndpoints()">Testa Alla Endpoints</button>
    </div>

    <div>
        <h2>7. Instruktioner</h2>
        <ol>
            <li>API URL √§r redan konfigurerad: https://zdgjj51feh.execute-api.eu-north-1.amazonaws.com</li>
            <li>√ñppna: http://localhost:3000/test-endpoints.html</li>
            <li>Skapa f√∂rst en anv√§ndare och logga in f√∂r att f√• auth token</li>
            <li>Skapa en quiz (kr√§ver auth token)</li>
            <li>L√§gg till fr√•gor till quizen (kr√§ver auth token)</li>
            <li>Testa att h√§mta quizer och fr√•gor (ingen auth kr√§vs)</li>
            <li>Anv√§nd "Testa Alla Endpoints" f√∂r automatiserad testning</li>
        </ol>
    </div>
</body>
</html>
