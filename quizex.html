<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Quiz App - QuizEx</title>
</head>
<body>
    <h1>Quiz App - QuizEx</h1>
    <p>API URL: https://zdgjj51feh.execute-api.eu-north-1.amazonaws.com</p>
    
    <!-- Register a new user -->
    <h2>1. Registrera Ny Användare</h2>
    <p>Namn: <input type="text" id="name" placeholder="Ditt namn"></p>
    <p>E-post: <input type="email" id="email" placeholder="din@email.com"></p>
    <p>Lösenord: <input type="password" id="password" placeholder="lösenord123"></p>
    <button onclick="register()">Registrera</button>
    
    <!-- Login -->
    <h2>2. Logga In</h2>
    <p>E-post: <input type="email" id="loginEmail" value="admin@quizex.com"></p>
    <p>Lösenord: <input type="password" id="loginPassword" value="admin123"></p>
    <button onclick="login()">Logga In</button>
    
    <!-- Get all quizzes -->
    <h2>3. Hämta Alla Quizer</h2>
    <button onclick="getQuizzes()">Hämta Quizer</button>
    <button onclick="playSimpleQuiz()">Spela Enkel Quiz</button>
    
    <!-- Get quiz questions -->
    <h2>4. Hämta Quiz Frågor</h2>
    <p>Quiz ID: <input type="text" id="quizId" value="_g51fF3dAoL8Xx73_IHXQ"></p>
    <button onclick="getQuestions()">Hämta Frågor</button>
    
    <!-- Simple Quiz Player -->
    <h2>4.1. Spela Quiz Interaktivt</h2>
    <div id="quizPlayer" style="border: 2px solid #007bff; padding: 15px; margin: 10px 0; background-color: #f8f9fa; display: none;">
        <h3 id="quizPlayerTitle">Quiz Spel</h3>
        <div id="quizQuestion">
            <p id="questionText"></p>
            <div id="questionOptions"></div>
            <button id="nextQuestionBtn" onclick="nextQuestion()" style="display: none;">Nästa Fråga</button>
            <button id="submitAnswerBtn" onclick="submitAnswer()">Svara</button>
        </div>
        <div id="quizResults" style="display: none;">
            <h4>Resultat</h4>
            <p id="finalScore"></p>
            <button onclick="startNewQuiz()">Spela Igen</button>
        </div>
    </div>
    <button onclick="startQuizPlayer()">Starta Quiz Spel</button>
    
    <!-- Get leaderboard -->
    <h2>5. Hämta Topplista</h2>
    <p>Quiz ID: <input type="text" id="leaderboardId" value="_g51fF3dAoL8Xx73_IHXQ"></p>
    <button onclick="getLeaderboard()">Hämta Topplista</button>
    
    <!-- Show all users -->
    <h2>6. Visa Alla Användare</h2>
    <button onclick="getUsers()">Hämta Användare</button>
    
    <!-- Delete user -->
    <h2>7. Ta Bort Användare</h2>
    <p>E-post: <input type="email" id="deleteEmail" placeholder="email@att.ta.bort"></p>
    <button onclick="deleteUser()">Ta Bort Användare</button>
    
    <!-- Results will show here -->
    <div id="result" style="display: none; margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9;"></div>

    <script>
        // The API URL - this is where our server is located
        const API_URL = 'https://zdgjj51feh.execute-api.eu-north-1.amazonaws.com';
        
        // Function to show results on the page
        function showResult(data, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.style.backgroundColor = isSuccess ? '#d4edda' : '#f8d7da';
            
            if (typeof data === 'object') {
                resultDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            } else {
                resultDiv.innerHTML = data;
            }
        }
        
        // 1. Register a new user
        async function register() {
            const data = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };
            
            // Check if all fields are filled
            if (!data.name || !data.email || !data.password) {
                showResult('Vänligen fyll i alla fält', false);
                return;
            }
            
            try {
                const response = await fetch(API_URL + '/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('Användare registrerad framgångsrikt! Välkommen ' + result.data.name, true);
                    // Clear the form
                    document.getElementById('name').value = '';
                    document.getElementById('email').value = '';
                    document.getElementById('password').value = '';
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Fel: ' + error.message, false);
            }
        }
        
        // 2. Login user
        async function login() {
            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };
            
            try {
                const response = await fetch(API_URL + '/simple/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('Inloggning lyckades! Välkommen ' + result.data.user.name, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Fel: ' + error.message, false);
            }
        }
        
        // 3. Get all quizzes
        async function getQuizzes() {
            try {
                const response = await fetch(API_URL + '/simple/quizzes');
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h3>Tillgängliga Quizer:</h3>';
                    result.data.forEach(quiz => {
                        html += '<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">';
                        html += '<strong>' + quiz.title + '</strong><br>';
                        html += 'ID: ' + quiz.quizId + '<br>';
                        html += 'Beskrivning: ' + quiz.description + '<br>';
                        html += 'Frågor: ' + quiz.questionCount;
                        html += '</div>';
                    });
                    showResult(html, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 4. Get quiz questions (simple version)
        async function getQuestions() {
            const quizId = document.getElementById('quizId').value;
            
            try {
                const response = await fetch(API_URL + '/simple/quiz/' + quizId + '/questions');
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h3>Quiz Questions:</h3>';
                    result.data.questions.forEach((q, index) => {
                        html += '<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">';
                        html += '<strong>Question ' + (index + 1) + ':</strong> ' + q.question + '<br>';
                        html += '<strong>Answer:</strong> ' + q.answer + '<br>';
                        html += '<strong>Options:</strong> ' + q.options.join(', ');
                        html += '</div>';
                    });
                    showResult(html, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 5. Create Quiz
        async function createQuiz() {
            const data = {
                title: document.getElementById('quizTitle').value,
                description: document.getElementById('quizDescription').value,
                createdBy: document.getElementById('quizCreatedBy').value
            };
            
            if (!data.title || !data.description || !data.createdBy) {
                showResult('Please fill all fields', false);
                return;
            }
            
            try {
                const response = await fetch(API_URL + '/quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('Quiz created successfully! ID: ' + result.data.quizId, true);
                    // Clear form
                    document.getElementById('quizTitle').value = '';
                    document.getElementById('quizDescription').value = '';
                    document.getElementById('quizCreatedBy').value = '';
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 6. Get All Quizzes
        async function getAllQuizzes() {
            try {
                const response = await fetch(API_URL + '/quizzes');
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h3>All Quizzes:</h3>';
                    result.data.forEach(quiz => {
                        html += '<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">';
                        html += '<strong>' + quiz.title + '</strong><br>';
                        html += 'ID: ' + quiz.quizId + '<br>';
                        html += 'Description: ' + quiz.description + '<br>';
                        html += 'Created by: ' + quiz.createdBy + '<br>';
                        html += 'Questions: ' + quiz.questionCount;
                        html += '</div>';
                    });
                    showResult(html, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 7. Add Question
        async function addQuestion() {
            const quizId = document.getElementById('addQuestionQuizId').value;
            const question = document.getElementById('questionText').value;
            const answer = document.getElementById('questionAnswer').value;
            const optionsText = document.getElementById('questionOptions').value;
            const lat = document.getElementById('questionLat').value;
            const lng = document.getElementById('questionLng').value;
            
            if (!quizId || !question || !answer || !optionsText || !lat || !lng) {
                showResult('Please fill all fields', false);
                return;
            }
            
            const options = optionsText.split(',').map(opt => opt.trim());
            
            const data = {
                question,
                answer,
                options,
                coordinates: {
                    latitude: parseFloat(lat),
                    longitude: parseFloat(lng)
                }
            };
            
            try {
                const response = await fetch(API_URL + '/quiz/' + quizId + '/question', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('Question added successfully! ID: ' + result.data.questionId, true);
                    // Clear form
                    document.getElementById('addQuestionQuizId').value = '';
                    document.getElementById('questionText').value = '';
                    document.getElementById('questionAnswer').value = '';
                    document.getElementById('questionOptions').value = '';
                    document.getElementById('questionLat').value = '';
                    document.getElementById('questionLng').value = '';
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 8. Get Quiz Questions (real version)
        async function getQuizQuestions() {
            const quizId = document.getElementById('getQuestionsQuizId').value;
            
            try {
                const response = await fetch(API_URL + '/quiz/' + quizId + '/questions');
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h3>Quiz Questions:</h3>';
                    html += '<p><strong>Quiz:</strong> ' + result.data.quizTitle + '</p>';
                    result.data.questions.forEach((q, index) => {
                        html += '<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">';
                        html += '<strong>Question ' + (index + 1) + ':</strong> ' + q.question + '<br>';
                        html += '<strong>Answer:</strong> ' + q.answer + '<br>';
                        html += '<strong>Options:</strong> ' + q.options.join(', ') + '<br>';
                        html += '<strong>Location:</strong> ' + q.coordinates.latitude + ', ' + q.coordinates.longitude;
                        html += '</div>';
                    });
                    showResult(html, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 9. Register Score
        async function registerScore() {
            const quizId = document.getElementById('scoreQuizId').value;
            const playerName = document.getElementById('playerName').value;
            const score = document.getElementById('playerScore').value;
            
            if (!quizId || !playerName || !score) {
                showResult('Please fill all fields', false);
                return;
            }
            
            const data = {
                playerName,
                score: parseInt(score)
            };
            
            try {
                const response = await fetch(API_URL + '/quiz/' + quizId + '/score', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('Score registered successfully! Score ID: ' + result.data.scoreId, true);
                    // Clear form
                    document.getElementById('playerName').value = '';
                    document.getElementById('playerScore').value = '';
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 5. Get leaderboard
        async function getLeaderboard() {
            const quizId = document.getElementById('leaderboardId').value;
            
            try {
                const response = await fetch(API_URL + '/simple/quiz/' + quizId + '/leaderboard');
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h3>Leaderboard:</h3>';
                    result.data.leaderboard.forEach((player, index) => {
                        html += '<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">';
                        html += '<strong>#' + (index + 1) + ' ' + player.playerName + '</strong> - ';
                        html += player.score + ' points';
                        html += '</div>';
                    });
                    showResult(html, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 6. Get all users
        async function getUsers() {
            try {
                const response = await fetch(API_URL + '/users');
                const result = await response.json();
                
                if (result.success) {
                    let html = '<h3>All Users:</h3>';
                    result.data.forEach((user, index) => {
                        html += '<div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">';
                        html += '<strong>User ' + (index + 1) + ':</strong><br>';
                        html += 'Name: ' + user.name + '<br>';
                        html += 'Email: ' + user.email + '<br>';
                        html += 'Created: ' + new Date(user.createdAt).toLocaleString();
                        html += '</div>';
                    });
                    showResult(html, true);
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // 7. Delete user
        async function deleteUser() {
            const email = document.getElementById('deleteEmail').value;
            
            if (!email) {
                showResult('Please enter an email', false);
                return;
            }
            
            if (!confirm('Are you sure you want to delete user: ' + email + '?')) {
                return;
            }
            
            try {
                const response = await fetch(API_URL + '/users/' + encodeURIComponent(email), {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('User deleted successfully: ' + email, true);
                    document.getElementById('deleteEmail').value = '';
                } else {
                    showResult(result, false);
                }
            } catch (error) {
                showResult('Error: ' + error.message, false);
            }
        }
        
        // Simple Quiz Play Function
        function playSimpleQuiz() {
            const questions = [
                {
                    question: "Vad är rätt sätt att deklarera en variabel i JavaScript?",
                    answer: "var, let, eller const",
                    options: ["var", "let", "const", "Alla ovanstående"]
                },
                {
                    question: "Vilken metod lägger till ett element i slutet av en array?",
                    answer: "push()",
                    options: ["push()", "pop()", "shift()", "unshift()"]
                },
                {
                    question: "Vad refererar 'this' till i JavaScript?",
                    answer: "Objektet som äger funktionen",
                    options: ["Globalt objekt", "Funktionen själv", "Objektet som äger funktionen", "Odefinierat"]
                }
            ];
            
            let currentQuestion = 0;
            let score = 0;
            let userAnswers = [];
            
            function showQuestion() {
                if (currentQuestion >= questions.length) {
                    finishQuiz();
                    return;
                }
                
                const q = questions[currentQuestion];
                let html = '<h3>Quiz ' + (currentQuestion + 1) + '/' + questions.length + '</h3>';
                html += '<p>' + q.question + '</p>';
                
                q.options.forEach((option, index) => {
                    html += '<button onclick="selectAnswer(' + index + ', \'' + option + '\')">' + option + '</button>';
                });
                
                html += '<br><button onclick="nextQuestion()" id="nextBtn" disabled>Nästa</button>';
                
                showResult(html, true);
            }
            
            window.selectAnswer = function(index, answer) {
                userAnswers[currentQuestion] = answer;
                document.getElementById('nextBtn').disabled = false;
            };
            
            window.nextQuestion = function() {
                if (userAnswers[currentQuestion] === questions[currentQuestion].answer) {
                    score++;
                }
                currentQuestion++;
                showQuestion();
            };
            
            function finishQuiz() {
                let html = '<h3>Quiz slut!</h3>';
                html += '<p>Din poäng: ' + score + '/' + questions.length + '</p>';
                
                if (score === questions.length) {
                    html += '<p>Perfekt! Du fick alla frågor rätt!</p>';
                } else if (score >= questions.length * 0.7) {
                    html += '<p>Bra jobbat! Du gjorde det bra!</p>';
                } else {
                    html += '<p>Fortsätt öva! Du kan göra bättre!</p>';
                }
                
                html += '<button onclick="playSimpleQuiz()">Spela Igen</button>';
                
                showResult(html, true);
            }
            
            // Reset and start
            currentQuestion = 0;
            score = 0;
            userAnswers = [];
            showQuestion();
        }
        
        // Quiz Player Functions
        let quizPlayerData = {
            questions: [],
            currentQuestion: 0,
            score: 0,
            userAnswers: []
        };
        
        async function startQuizPlayer() {
            const quizId = document.getElementById('quizId').value;
            if (!quizId) {
                showResult('Ange ett Quiz ID', false);
                return;
            }
            
            try {
                const response = await fetch(API_URL + '/quiz/' + quizId + '/questions');
                const result = await response.json();
                
                if (result.success && result.data.questions) {
                    quizPlayerData.questions = result.data.questions;
                    quizPlayerData.currentQuestion = 0;
                    quizPlayerData.score = 0;
                    quizPlayerData.userAnswers = [];
                    
                    document.getElementById('quizPlayer').style.display = 'block';
                    document.getElementById('quizPlayerTitle').textContent = 'Quiz Spel - ' + quizId;
                    showQuizQuestion();
                } else {
                    showResult('Kunde inte hämta quiz frågor: ' + (result.message || 'Okänt fel'), false);
                }
            } catch (error) {
                showResult('Fel vid hämtning av quiz: ' + error.message, false);
            }
        }
        
        function showQuizQuestion() {
            const question = quizPlayerData.questions[quizPlayerData.currentQuestion];
            if (!question) {
                finishQuizPlayer();
                return;
            }
            
            document.getElementById('questionText').textContent = 
                `Fråga ${quizPlayerData.currentQuestion + 1}: ${question.question}`;
            
            const optionsDiv = document.getElementById('questionOptions');
            optionsDiv.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const label = document.createElement('label');
                label.style.display = 'block';
                label.style.margin = '5px 0';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'quizAnswer';
                radio.value = option;
                radio.id = 'option' + index;
                
                label.appendChild(radio);
                label.appendChild(document.createTextNode(' ' + option));
                optionsDiv.appendChild(label);
            });
            
            document.getElementById('submitAnswerBtn').style.display = 'inline-block';
            document.getElementById('nextQuestionBtn').style.display = 'none';
        }
        
        function submitAnswer() {
            const selectedAnswer = document.querySelector('input[name="quizAnswer"]:checked');
            if (!selectedAnswer) {
                showResult('Välj ett svar först!', false);
                return;
            }
            
            const question = quizPlayerData.questions[quizPlayerData.currentQuestion];
            const isCorrect = selectedAnswer.value === question.answer;
            
            if (isCorrect) {
                quizPlayerData.score++;
                showResult('Rätt! Bra jobbat!', true);
            } else {
                showResult('Fel! Rätt svar var: ' + question.answer, false);
            }
            
            quizPlayerData.userAnswers.push(selectedAnswer.value);
            
            document.getElementById('submitAnswerBtn').style.display = 'none';
            document.getElementById('nextQuestionBtn').style.display = 'inline-block';
        }
        
        function nextQuestion() {
            quizPlayerData.currentQuestion++;
            showQuizQuestion();
        }
        
        function finishQuizPlayer() {
            document.getElementById('quizQuestion').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            
            const percentage = Math.round((quizPlayerData.score / quizPlayerData.questions.length) * 100);
            document.getElementById('finalScore').textContent = 
                `Du fick ${quizPlayerData.score} av ${quizPlayerData.questions.length} rätt (${percentage}%)`;
            
            if (percentage === 100) {
                document.getElementById('finalScore').innerHTML += '<br><strong>Perfekt! Du fick alla frågor rätt!</strong>';
            } else if (percentage >= 70) {
                document.getElementById('finalScore').innerHTML += '<br><strong>Bra jobbat!</strong>';
            } else {
                document.getElementById('finalScore').innerHTML += '<br><strong>Försök igen!</strong>';
            }
        }
        
        function startNewQuiz() {
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('quizQuestion').style.display = 'block';
            startQuizPlayer();
        }
    </script>
</body>
</html>